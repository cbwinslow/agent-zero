<html>

<head>
    <title>Discover MCP Servers</title>

    <script type="module">
        import { store } from "/components/settings/mcp/discovery/mcp-discovery-store.js";
    </script>
</head>

<body>
    <div x-data>
        <template x-if="$store.mcpDiscoveryStore">
            <div x-init="$store.mcpDiscoveryStore.initialize()">

                <h3>Discover MCP Servers
                    <button class="btn slim primary" style="margin-left: 0.5em;"
                        @click="$store.mcpDiscoveryStore.discoverServers(true)"
                        :disabled="$store.mcpDiscoveryStore.loading">
                        <span x-show="!$store.mcpDiscoveryStore.loading">üîÑ Refresh</span>
                        <span x-show="$store.mcpDiscoveryStore.loading">Loading...</span>
                    </button>
                </h3>

                <p style="margin-bottom: 1em; opacity: 0.8;">
                    Browse and discover MCP servers from npm, GitHub, and Docker Hub.
                    Click on a server to view details and copy its configuration.
                </p>

                <!-- Filters and Search -->
                <div class="discovery-filters">
                    <input type="text" 
                        placeholder="üîç Search servers..." 
                        x-model="$store.mcpDiscoveryStore.searchQuery"
                        @input="$store.mcpDiscoveryStore.onSearchChange()"
                        class="search-input">
                    
                    <select x-model="$store.mcpDiscoveryStore.sourceFilter"
                        @change="$store.mcpDiscoveryStore.onSourceFilterChange()"
                        class="filter-select">
                        <option value="all">All Sources</option>
                        <option value="npm">üì¶ npm</option>
                        <option value="github">üêô GitHub</option>
                        <option value="docker">üê≥ Docker Hub</option>
                    </select>
                    
                    <select x-model="$store.mcpDiscoveryStore.sortBy"
                        @change="$store.mcpDiscoveryStore.onSortChange()"
                        class="filter-select">
                        <option value="popularity">Sort by Popularity</option>
                        <option value="name">Sort by Name</option>
                        <option value="date">Sort by Date</option>
                    </select>
                </div>

                <!-- Server Count -->
                <div class="server-count" x-show="!$store.mcpDiscoveryStore.loading">
                    <span x-text="$store.mcpDiscoveryStore.filteredServers.length"></span> servers found
                </div>

                <!-- Server List -->
                <div class="discovery-server-list" x-show="!$store.mcpDiscoveryStore.loading">
                    <template x-for="server in $store.mcpDiscoveryStore.filteredServers" :key="server.full_name">
                        <div class="discovery-server-item" 
                            @click="$store.mcpDiscoveryStore.viewServerDetails(server)">
                            
                            <div class="server-header">
                                <span class="source-icon" 
                                    x-text="$store.mcpDiscoveryStore.getSourceIcon(server.source)"></span>
                                <span class="server-name" x-text="server.name"></span>
                                <span class="server-stats">
                                    <template x-if="server.stars">
                                        <span>‚≠ê <span x-text="$store.mcpDiscoveryStore.formatNumber(server.stars)"></span></span>
                                    </template>
                                    <template x-if="server.downloads">
                                        <span>üì• <span x-text="$store.mcpDiscoveryStore.formatNumber(server.downloads)"></span></span>
                                    </template>
                                    <template x-if="server.pulls">
                                        <span>üì• <span x-text="$store.mcpDiscoveryStore.formatNumber(server.pulls)"></span></span>
                                    </template>
                                </span>
                            </div>
                            
                            <div class="server-description" x-text="server.description || 'No description available'"></div>
                            
                            <div class="server-footer">
                                <span class="server-source" 
                                    :style="'color: ' + $store.mcpDiscoveryStore.getSourceColor(server.source)"
                                    x-text="server.source"></span>
                                <template x-if="server.language">
                                    <span class="server-language" x-text="server.language"></span>
                                </template>
                                <button class="add-server-btn" 
                                    @click.stop="$store.mcpDiscoveryStore.addServerToConfig(server)">
                                    ‚ûï Add
                                </button>
                            </div>
                        </div>
                    </template>
                    
                    <div x-show="$store.mcpDiscoveryStore.filteredServers.length === 0" class="no-servers">
                        No servers found matching your criteria.
                    </div>
                </div>

                <div x-show="$store.mcpDiscoveryStore.loading" class="discovery-loading">
                    üîÑ Discovering MCP servers from npm, GitHub, and Docker Hub...
                </div>
            </div>
        </template>
    </div>

    <style>
        .discovery-filters {
            display: flex;
            gap: 0.5em;
            margin-bottom: 1em;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 0.5em;
            border: 1px solid rgba(192, 192, 192, 0.3);
            border-radius: 4px;
            background: var(--c-bg);
            color: var(--c-fg);
        }

        .filter-select {
            padding: 0.5em;
            border: 1px solid rgba(192, 192, 192, 0.3);
            border-radius: 4px;
            background: var(--c-bg);
            color: var(--c-fg);
        }

        .server-count {
            margin-bottom: 1em;
            opacity: 0.7;
            font-size: 0.9em;
        }

        .discovery-server-list {
            display: flex;
            flex-direction: column;
            gap: 0.5em;
            margin-bottom: 1em;
        }

        .discovery-server-item {
            padding: 0.8em;
            border: 1px solid rgba(192, 192, 192, 0.2);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .discovery-server-item:hover {
            border-color: rgba(192, 192, 192, 0.5);
            background: rgba(192, 192, 192, 0.05);
        }

        .server-header {
            display: flex;
            align-items: center;
            gap: 0.5em;
            margin-bottom: 0.5em;
        }

        .source-icon {
            font-size: 1.2em;
        }

        .server-name {
            font-weight: 600;
            flex: 1;
        }

        .server-stats {
            display: flex;
            gap: 0.8em;
            font-size: 0.85em;
            opacity: 0.7;
        }

        .server-description {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 0.5em;
            line-height: 1.4;
        }

        .server-footer {
            display: flex;
            align-items: center;
            gap: 0.5em;
            font-size: 0.85em;
        }

        .server-source {
            font-weight: 600;
        }

        .server-language {
            opacity: 0.6;
        }

        .add-server-btn {
            margin-left: auto;
            padding: 0.3em 0.6em;
            border: 1px solid rgba(192, 192, 192, 0.3);
            border-radius: 4px;
            background: rgba(0, 200, 100, 0.1);
            cursor: pointer;
            font-size: 0.9em;
        }

        .add-server-btn:hover {
            background: rgba(0, 200, 100, 0.2);
        }

        .discovery-loading {
            width: 100%;
            text-align: center;
            margin: 2rem 0;
            font-size: 1.1em;
        }

        .no-servers {
            padding: 2em;
            text-align: center;
            opacity: 0.6;
            font-style: italic;
        }
    </style>

</body>

</html>
